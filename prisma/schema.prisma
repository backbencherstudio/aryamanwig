generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearchPostgres"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id         String   @id @default(cuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  user_id String
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  type                String?
  provider            String?
  provider_account_id String?
  refresh_token       String?
  access_token        String?
  expires_at          DateTime?
  token_type          String?
  scope               String?
  id_token            String?
  session_state       String?

  @@unique([provider, provider_account_id])
  @@map("accounts")
}



model User {
  id String @id @default(cuid())

  status       Int?    @default(0) @db.SmallInt
  availability String?
  

  email String? @unique

  type              String?   @default("user")
  email_verified_at DateTime?
  name              String?   @db.VarChar(255)
  first_name        String?   @db.VarChar(255)
  last_name         String?   @db.VarChar(255)
  password          String?   @db.VarChar(255)
  avatar            String?
  cover_photo       String?
  // domain            String?   @unique
  username          String?   @unique

  phone_number  String?
  country       String?
  state         String?
  city          String?
  address       String?
  zip_code      String?
  gender        String?
  date_of_birth DateTime? @db.Date

  

  // google id
   googleId          String?   @unique // Store Google ID for OAuth
   apple_id          String?   @unique
   accessToken       String?
   refreshToken      String?

  // billing id. e.g. stripe customer id
  billing_id String?

  is_two_factor_enabled Int?    @default(0)
  two_factor_secret     String? // secret key for two factor authentication


  // --- Conversation & Messaging ---
  sentMessages        Message[]            @relation("messageSender")
  participants        Participant[]        @relation("participantUser")
  notificationsSent   Notification[]       @relation("notificationSender")
  notificationsReceived Notification[]     @relation("notificationReceiver")

  accounts              Account[]
  user_payment_methods UserPaymentMethod[]
  user_settings        UserSetting[]
  ucodes               Ucode[]
  roles                Role[]
  role_users           RoleUser[]
  payment_transactions PaymentTransaction[]

  // relationship with product
  products Product[]

  // relationship with category
  categories Category[]

  // relation with wishlist
  wishlists Wishlist[]

  // relationship with disposal requests
  disposals Disposal[]

  // relation with review
  reviews       Review[]
  Cart          Cart[]
  orders        Order[]
  orders_buyer  Order[]  @relation("OrderBuyer")
  orders_seller Order[]  @relation("OrderSeller")

  // relation with bid
  bids Bid[] @relation("UserBids")

  // 



  approved_at DateTime?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @default(now())
  deleted_at  DateTime?

  @@map("users")
}

/**
 * add new schema models below
 */

enum Condition {
  NEW
  OLD
}

enum ProductStatus {
  PENDING
  APPROVED
  REJECTED
}


enum BoostTier {
  TIER_1 
  TIER_2 
  TIER_3 
}

enum BoostPaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

enum ProductItemSize {
  SMALL
  MEDIUM
  LARGE
  EXTRA_LARGE
}

model Product {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  product_title       String
  product_description String
  stock               Int     @default(1)
  price               Decimal @db.Decimal(10, 2)
  photo               String[] @db.Text
  product_item_size   ProductItemSize @default(SMALL)

  location String?
  size     String?
  color    String?
  time     DateTime?

  boost_until DateTime? 
  is_boosted  Boolean   @default(false)

  boost_tier            BoostTier? 
  boost_payment_status  BoostPaymentStatus? 

  condition Condition? @default(NEW)
  status    ProductStatus @default(PENDING)

  // product_Owner
  user_id     String?
  user        User?       @relation(fields: [user_id], references: [id])
  // relationship with category
  category_id String?
  category    Category?   @relation(fields: [category_id], references: [id])
  // relation with wishlist
  wishlists   Wishlist[]
  CartItem    CartItem[]
  OrderItem   OrderItem[]

  // relationship with disposal requests
  disposals         Disposal[]

  // relation with bid
  bids Bid[] @relation("ProductBids")

  @@map("products")
}

model Category {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  category_name        String  @unique
  category_description String?
  photo                String?
  status               Int?    @default(1) @db.SmallInt

  // relationship with product
  products Product[]

  // category_Owner
  category_owner String?
  category       User?   @relation(fields: [category_owner], references: [id])
  //  relation with wishlist

  @@map("categories")
}

model Wishlist {
  id         String   @id @default(cuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  product_id String?
  product    Product? @relation(fields: [product_id], references: [id])

  @@unique([user_id, product_id])
  @@map("wishlists")
}

model Review {
  id         String   @id @default(cuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  rating  Int
  comment String?
  status  Int?    @default(1) @db.SmallInt

  // ðŸ”— Relation with Order
  order_id String?
  order    Order?  @relation("OrderToReview", fields: [order_id], references: [id])

  review_receiver String? 
  review_sender   String? 

  user User? @relation(fields: [review_sender], references: [id])

  @@unique([order_id])

  @@map("reviews")
}

model Cart {

  id        String     @id @default(cuid())
  user_id   String
  user      User       @relation(fields: [user_id], references: [id], onDelete: Cascade)
  cartItems CartItem[]
  

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  @@map("carts")
}

model CartItem {
  id String @id @default(cuid())

  cart_id String
  cart    Cart   @relation(fields: [cart_id], references: [id], onDelete: Cascade)

  product_id String
  product    Product @relation(fields: [product_id], references: [id], onDelete: Cascade)

  quantity    Int     @default(1)
  total_price Decimal @db.Decimal(10, 2)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  @@map("cart_items")
}


enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  RETURNED
}

enum PaymentStatus {
  DUE
  PAID
  FAILED
  REFUNDED
}

model Order {
  id             String        @id @default(cuid())
  buyer_id       String 
  buyer          User          @relation("OrderBuyer", fields: [buyer_id], references: [id], onDelete: Cascade)
  seller_id      String 
  seller         User          @relation("OrderSeller", fields: [seller_id], references: [id], onDelete: Cascade)
  order_status   OrderStatus   @default(PENDING)
  payment_status PaymentStatus @default(DUE)
  grand_total    Decimal       @db.Decimal(10, 2)

  shipping_name     String
  email             String
  shipping_country  String
  shipping_state    String
  shipping_city     String
  shipping_zip_code String
  shipping_address  String
  created_at        DateTime    @default(now())
  updated_at        DateTime    @default(now())
  delivery_date     DateTime?  

  reviews Review[] @relation("OrderToReview")

  order_items       OrderItem[]
  User              User?       @relation(fields: [userId], references: [id])
  userId            String?

  @@map("orders")
}

model OrderItem {
  id          String  @id @default(cuid())
  order_id    String
  order       Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product_id  String
  product     Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  quantity    Int
  total_price Decimal @db.Decimal(10, 2)

  @@map("order_items")
}


model Bid {
  id         String   @id @default(cuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  user_id String
  user    User   @relation("UserBids", fields: [user_id], references: [id], onDelete: Cascade)

  product_id String
  product    Product @relation("ProductBids", fields: [product_id], references: [id], onDelete: Cascade)

  bid_amount Decimal   @db.Decimal(10, 2)
  status     BidStatus @default(PENDING)

  @@map("bids")
}

enum BidStatus {
  PENDING
  ACCEPTED
  REJECTED
}




model Ucode {
  id         String   @id @default(cuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  status     Int?     @default(1) @db.SmallInt

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  token      String?
  email      String?
  expired_at DateTime?

  @@map("ucodes")
}

model Role {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status Int?    @default(1) @db.SmallInt
  title  String?
  name   String?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  permission_roles PermissionRole[]
  role_users       RoleUser[]
  permissions      Permission[]     @relation("PermissionToRole")

  @@map("roles")
}

model Permission {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status     Int?    @default(1) @db.SmallInt
  title      String?
  action     String?
  subject    String?
  conditions String?
  fields     String?

  permission_roles PermissionRole[]
  roles            Role[]           @relation("PermissionToRole")

  @@map("permissions")
}

model PermissionRole {
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  permission_id String
  permission    Permission @relation(fields: [permission_id], references: [id], onDelete: Cascade)

  role_id String
  role    Role   @relation(fields: [role_id], references: [id], onDelete: Cascade)

  @@id([permission_id, role_id])
  @@map("permission_roles")
}

model RoleUser {
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  role_id String
  role    Role   @relation(fields: [role_id], references: [id], onDelete: Cascade)

  user_id String
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([role_id, user_id])
  @@map("role_users")
}

// this table stores notification event
// model NotificationEvent {
//   id         String    @id @default(cuid())
//   created_at DateTime  @default(now())
//   updated_at DateTime  @default(now())
//   deleted_at DateTime?

//   status Int?    @default(1) @db.SmallInt
//   type   String?
//   text   String?

//   notifications Notification[]

//   @@map("notification_events")
// }

// model Notification {
//   id         String    @id @default(cuid())
//   created_at DateTime  @default(now())
//   updated_at DateTime  @default(now())
//   deleted_at DateTime?

//   read_at DateTime?

//   status Int? @default(1) @db.SmallInt

//   sender_id String?
//   sender    User?   @relation("sender", fields: [sender_id], references: [id])

//   receiver_id String?
//   receiver    User?   @relation("receiver", fields: [receiver_id], references: [id])

//   notification_event_id String?
//   notification_event    NotificationEvent? @relation(fields: [notification_event_id], references: [id])

//   entity_id String?

//   @@map("notifications")
// }

model UserPaymentMethod {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  payment_method_id String?
  checkout_id       String?

  @@map("user_payment_methods")
}

model PaymentTransaction {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  store_id String?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  order_id         String?
  type             String?  @default("order")
  withdraw_via     String?  @default("wallet")
  provider         String?
  reference_number String?
  status           String?  @default("pending")
  raw_status       String?
  amount           Decimal?
  currency         String?
  paid_amount      Decimal?
  paid_currency    String?

  @@map("payment_transactions")
}

// ---------Start Chat schema---------//

/*
enum MessageStatus {
  PENDING
  SENT
  DELIVERED
  READ
}

// message is used for conversation
model Message {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status MessageStatus? @default(PENDING)

  sender_id String?
  sender    User?   @relation("sender", fields: [sender_id], references: [id])

  receiver_id String?
  receiver    User?   @relation("receiver", fields: [receiver_id], references: [id])

  conversation_id String?
  conversation    Conversation? @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  message         String?

  attachment_id String?
  attachment    Attachment? @relation(fields: [attachment_id], references: [id])

  last_message_conversation Conversation? @relation("last_message")

  @@map("messages")
}

// this table stores attachment of message
model Attachment {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  name     String?
  type     String?
  size     Int?
  file     String?
  file_alt String?

  messages Message[]

  @@map("attachments")
}

// this table stores conversation
model Conversation {
  id String @id @default(cuid())

  creator_id String?
  creator    User?   @relation("creator", fields: [creator_id], references: [id])

  participant_id String?
  participant    User?   @relation("participant", fields: [participant_id], references: [id])

  last_message_id String?  @unique
  last_message    Message? @relation("last_message", fields: [last_message_id], references: [id])

  // deleted
  deleted_by_creator        Boolean   @default(false)
  deleted_by_participant    Boolean   @default(false)
  deleted_by_creator_at     DateTime?
  deleted_by_participant_at DateTime?

  // blocked
  blocked_by_creator     Boolean @default(false)
  blocked_by_participant Boolean @default(false)

  messages Message[]

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  @@map("conversations")
}
*/

model Conversation {
  id           String             @id @default(cuid())
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  messages     Message[]
  participants Participant[]
}

model Participant {
  id             String             @id @default(cuid())
  conversationId String
  conversation   Conversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  userId         String
  user           User            @relation("participantUser", fields: [userId], references: [id], onDelete: Cascade)

  role           String?         @default("participant")
  joinedAt       DateTime        @default(now())

  lastReadAt     DateTime?

  @@unique([conversationId, userId])
}

enum MessageStatus {
  PENDING
  SENT
  DELIVERED
  READ
}

model Message {
  id             String             @id @default(cuid())
  text           String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  status         MessageStatus   @default(PENDING)

  senderId       String
  sender         User            @relation("messageSender", fields: [senderId], references: [id], onDelete: Cascade)

  conversationId String
  conversation   Conversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  attachments    String[]           @db.Text
}

model NotificationEvent {
  id             String          @id @default(uuid())
  created_at     DateTime        @default(now())
  updated_at     DateTime        @default(now()) @updatedAt
  deleted_at     DateTime?
  status         Int?            @default(1) @db.SmallInt
  type           String?
  text           String?
  notifications  Notification[]
}

model Notification {
  id                     String                @id @default(cuid())
  created_at             DateTime            @default(now())
  updated_at             DateTime            @default(now()) @updatedAt
  deleted_at             DateTime?
  read_at                DateTime?
  status                 Int?                @default(1) @db.SmallInt

  sender_id              String?
  sender                 User?               @relation("notificationSender", fields: [sender_id], references: [id])

  receiver_id            String?
  receiver               User?               @relation("notificationReceiver", fields: [receiver_id], references: [id])

  notification_event_id  String?
  notification_event     NotificationEvent?  @relation(fields: [notification_event_id], references: [id])

  entity_id              String?
}


// model Attachment {
//   id         String    @id @default(cuid())
//   created_at DateTime  @default(now())
//   updated_at DateTime  @default(now())
//   deleted_at DateTime?

//   name     String?
//   type     String?
//   size     Int?
//   file     String?
//   file_alt String?

//   messages Message[]

//   @@map("attachments")
// }


// disposal product related models

enum DisposalType {
  PICKUP
  SEND_IN
}

enum DisposalStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum DisposalItemSize {
  SMALL
  MEDIUM
  LARGE
  EXTRA_LARGE
}

/*
enum PaymentStatus {
  DUE
  PAID
  FAILED
  REFUNDED
}
*/

model Disposal {
  id              String          @id @default(cuid())
  created_at      DateTime        @default(now())
  updated_at      DateTime        @default(now())
  deleted_at      DateTime?

  type            DisposalType
  status          DisposalStatus?  @default(PENDING)
  item_size       DisposalItemSize? @default(SMALL)

  place_city     String?
  place_name     String?
  place_address  String?

  payment_status PaymentStatus?   @default(DUE)

  scheduled_at   DateTime?
  final_total_amount Decimal?     @db.Decimal(10, 2)

  base_fee       Decimal?         @db.Decimal(10, 2)
  item_total_fee Decimal?         @db.Decimal(10, 2)

  product_id       String        
  product          Product        @relation(fields: [product_id], references: [id], onDelete: Cascade)
 
  user_id         String        
  user            User           @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("disposals")
}









// ---------End Chat schema---------

model Faq {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status     Int?    @default(1) @db.SmallInt
  sort_order Int?    @default(0)
  question   String?
  answer     String?

  @@map("faqs")
}

model Contact {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  first_name   String?
  last_name    String?
  email        String?
  phone_number String?
  message      String?

  @@map("contacts")
}

model SocialMedia {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  status     Int?    @default(1) @db.SmallInt
  sort_order Int?    @default(0)
  name       String?
  url        String?
  icon       String?

  @@map("social_medias")
}

model WebsiteInfo {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  name                String?
  phone_number        String?
  email               String?
  address             String?
  logo                String?
  favicon             String?
  copyright           String?
  cancellation_policy String?

  @@map("website_infos")
}

model Setting {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  category      String?
  label         String?
  description   String?
  key           String? @unique
  default_value String?

  user_settings UserSetting[]

  @@map("settings")
}

model UserSetting {
  id         String    @id @default(cuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @default(now())
  deleted_at DateTime?

  user_id String?
  user    User?   @relation(fields: [user_id], references: [id])

  setting_id String?
  setting    Setting? @relation(fields: [setting_id], references: [id])

  value String?

  @@map("user_settings")
}
